{"version":3,"sources":["webpack:///./src/components/PunchCard.vue?a01b","webpack:///./src/components/PunchCard.vue?dd37","webpack:///./src/components/PunchCard.vue?729d","webpack:///./src/components/PunchCard.vue?418f","webpack:///./src/components/PunchCard.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","ref","attrs","staticStyle","on","photograph","_v","attendInfo","_s","username","clazzname","groupname","staticRenderFns","params","console","log","punch","Object","assign","format","file","formdata","FormData","append","res","data","length","$message","warning","msg","setTimeout","$router","go","temp","_","cloneDeep","flag","punchCard","r","parseInt","code","$notify","title","message","self","navigator","mediaDevices","getUserMedia","video","then","success","$refs","srcObject","play","catch","error","ctx","getContext","drawImage","imgBase64","toDataURL","Date","now","photoPunch","stream","tracks","getTracks","forEach","track","stop","callCamera","closeCamera","component"],"mappings":"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","file":"js/chunk-79e1b480.0844eb0e.js","sourcesContent":["import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../node_modules/css-loader/index.js??ref--10-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PunchCard.vue?vue&type=style&index=0&id=57707ad9&lang=less&scoped=true&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../node_modules/css-loader/index.js??ref--10-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PunchCard.vue?vue&type=style&index=0&id=57707ad9&lang=less&scoped=true&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"punch-card\"},[_c('div',{staticClass:\"content\"},[_c('canvas',{ref:\"canvas\",attrs:{\"width\":\"320\",\"height\":\"240\"}}),_c('video',{ref:\"video\",staticClass:\"video-img\"}),_c('el-button',{staticStyle:{\"margin-top\":\"20px\"},attrs:{\"type\":\"primary\"},on:{\"click\":_vm.photograph}},[_vm._v(\"拍照\")])],1),_c('div',{staticClass:\"attend-info\"},[_c('h3',[_vm._v(\"打卡信息\")]),_c('el-divider'),_c('el-form',{ref:\"form\",attrs:{\"model\":_vm.attendInfo,\"label-width\":\"80px\"}},[_c('el-form-item',{attrs:{\"label\":\"姓名：\"}},[_c('span',[_vm._v(_vm._s(_vm.attendInfo.username))])]),_c('el-form-item',{attrs:{\"label\":\"课程：\"}},[_c('span',[_vm._v(_vm._s(_vm.attendInfo.clazzname))])]),_c('el-form-item',{attrs:{\"label\":\"教室：\"}},[_c('span',[_vm._v(_vm._s(_vm.attendInfo.groupname))])])],1)],1)])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport { Component, Vue } from 'vue-property-decorator';\nimport { dataURLtoFile, setPageTitle } from '@/utils/utils';\nimport { photoPunch, punchCard } from '@/http/api';\nimport { Res } from '@/interface';\nimport momemt from 'moment';\n\n@Component({})\nexport default class PunchCard extends Vue {\n\tprivate attendInfo = {\n\t\tusername: '',\n\t\tgroupname: '',\n\t\tclazzname: '',\n\t};\n\tpublic async punchCard(params: any): Promise<Res> {\n\t\tconsole.log('puncg');\n\t\tconst punch = Object.assign(params);\n\t\tpunch['signdate'] = momemt(punch['signdate']).format('YYYY-MM-DD');\n\t\tpunch['starttime'] = momemt(punch['starttime']).format('YYYY-MM-DD');\n\t\tpunch['state'] = punch['flag'];\n\t\tdelete punch['flag'];\n\t\treturn await punchCard(punch);\n\t}\n\tpublic async photoPunch(file: File) {\n\t\tconst formdata: any = new FormData();\n\t\tformdata.append('now', momemt().format('YYYY-MM-DD'));\n\t\tformdata.append('nowtime', momemt().format('HH:mm:ss'));\n\t\tformdata.append('img', file);\n\t\tconst res = await photoPunch(formdata);\n\t\tif (res.data === null || !res.data.length) {\n\t\t\tthis.$message.warning(res.msg);\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.$router.go(0);\n\t\t\t}, 3000);\n\t\t\treturn;\n\t\t}\n\t\tconst temp = !res.data ? {} : this._.cloneDeep(res.data[0]);\n\t\tthis.attendInfo = Object.assign(this.attendInfo, temp);\n\t\tconst flag: number = temp.flag;\n\t\tif (flag === 1 || flag === 3) {\n\t\t\tconst r: Res = await this.punchCard(temp);\n\t\t\tif (parseInt(r.code, 10) === 1) {\n\t\t\t\tthis.$notify[flag === 1 ? 'success' : 'error']({\n\t\t\t\t\ttitle: '打卡',\n\t\t\t\t\tmessage: flag === 1 ? '打卡成功！' : '打卡成功(已迟到)！',\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\tif (flag === -1) {\n\t\t\tthis.$notify.warning({\n\t\t\t\ttitle: '打卡',\n\t\t\t\tmessage: '该课程打卡未开始！',\n\t\t\t});\n\t\t}\n\t\tsetTimeout(() => {\n\t\t\tthis.$router.go(0);\n\t\t}, 3000);\n\t}\n\tpublic callCamera() {\n\t\tconst self = this;\n\t\t// H5调用电脑摄像头API\n\t\tnavigator.mediaDevices.getUserMedia({\n\t\t\tvideo: true,\n\t\t}).then((success: any) => {\n\t\t\t// 摄像头开启成功\n\t\t\t(this.$refs['video'] as any).srcObject = success;\n\t\t\t// 实时拍照效果\n\t\t\t(this.$refs['video'] as any).play();\n\t\t}).catch((error: any) => {\n\t\t\tself.$notify.error({\n\t\t\t\ttitle: '开启摄像头',\n\t\t\t\tmessage: '摄像头开启失败，请检查摄像头是否可用！',\n\t\t\t});\n\t\t});\n\t}\n\n\tpublic photograph() {\n\t\tconst ctx = (this.$refs['canvas'] as any).getContext('2d');\n\t\t// 把当前视频帧内容渲染到canvas上\n\t\tctx.drawImage(this.$refs['video'], 0, 0, 320, 240);\n\t\t// 转base64格式、图片格式转换、图片质量压缩\n\t\tconst imgBase64 = (this.$refs['canvas'] as any).toDataURL('image/jpeg');\n\t\tconst file = dataURLtoFile(imgBase64, `${Date.now()}.jpg`);\n\t\tthis.photoPunch(file);\n\t}\n\n\tpublic closeCamera() {\n\t\tif (!(this.$refs['video'] as any).srcObject) {\n\t\t\treturn;\n\t\t}\n\t\tconst stream = (this.$refs['video'] as any).srcObject;\n\t\tconst tracks = stream.getTracks();\n\t\ttracks.forEach((track: any) => {\n\t\t\ttrack.stop();\n\t\t});\n\t\t(this.$refs['video'] as any).srcObject = null;\n\t}\n\n\tpublic created() {\n\t\tsetPageTitle('学生打卡');\n\t\tthis.callCamera();\n\t}\n\tpublic beforeDestroy() {\n\t\tthis.closeCamera();\n\t}\n}\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--13-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PunchCard.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--13-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PunchCard.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./PunchCard.vue?vue&type=template&id=57707ad9&scoped=true&\"\nimport script from \"./PunchCard.vue?vue&type=script&lang=ts&\"\nexport * from \"./PunchCard.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./PunchCard.vue?vue&type=style&index=0&id=57707ad9&lang=less&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"57707ad9\",\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}